<% if @category.present? %>
<div id="checklist-content" class="checklist-container scrollable" tabindex="-1">
    <div class="scroll-bar vertical" style="height: 320px; display: block;">
        <div class="thumb" style="top: 0px; height: 118.794px;"></div>
    </div>
    <div class="viewport" style="height: 320px; width: 667px;">
        <div class="overview" style="top: 0px; left: 0px;">
            <% @category.each_with_index do |cat, index| %>
            <h6 class=""><%= cat %></h6>     
            <div class="checklist-content-section-<%= index+1 %>">
                <% @checklists.each do |checklist| %>
                <% if checklist.category == cat %>
                <div class="checklist-item">
                    <% if checklist.sub_category.blank? %>
                        <input type="checkbox" name="<%= cat.parameterize.underscore %>" class="checkbox-options options checkbox-popup" id="checklistitem-<%= checklist.id %>" <%= 'checked' if @checklist_answers.map(&:title).include?("#{checklist.title}")%>>
                        <label for="checklistitem-<%= checklist.id %>" id="l-checklistitem-<%= checklist.id %>"><%= checklist.title %></label>
                    <% else %>
                        <p><%= checklist.sub_category %></p>
                        <ul>
                            <li>
                                <input type="checkbox" name="<%= cat.parameterize.underscore %>" class="checkbox-options options checkbox-popup" id="checklistitem_sub-<%= checklist.id %>" <%= 'checked' if @checklist_answers.map(&:title).include?("#{checklist.title}")%>>
                                <label for="checklistitem_sub-<%= checklist.id %>" id="l-checklistitem_sub-<%= checklist.id %>"><%= checklist.title %></label>
                            </li>
                        </ul>
                    <% end %>
                </div> 
                <% end %>           
                <% end %>
                 <% @self_checklists.each do |checklist| %>
                 <% if checklist.category == cat %>
                <div class="checklist-item">
                    <input type="checkbox" name="<%= cat.parameterize.underscore %>" class="checkbox-options options checkbox-popup" id="checklistitem-self-<%= checklist.id %>-<%= cat %>" <%= 'checked' if @checklist_answers.map(&:title).include?("#{checklist.title}")%>>
                        <label for="checklistitem-<%= checklist.id %>-<%= cat %>" id="l-checklistitem-self-<%= checklist.id %>"><%= checklist.title %></label>
                </div>
                <% end %>
                <% end %>
                <div class="add-checklistitem">
                <input type="text" name="" class="options" placeholder="Add Your Own" id="add-checklistitem-text-<%= index+1 %>" />
                <a href="javascript:void(0);" class="button add-checklist" id="add-checklist-<%= index+1 %>">add</a>

                </div>
            </div>
            <script type="text/javascript">
                $(document).on("click", "#add-checklist-<%= index+1 %>", function(){
                    var rno = Math.floor((Math.random() * 10000) + 1);
            var getinputVal = jQuery(this).closest(".checklist-content-section-<%= index+1 %>").find("input#add-checklistitem-text-<%= index+1 %>").val();
            var addchecklist_item = '<div class="checklist-item">';
            addchecklist_item +="<input type='checkbox' name=" + "<%= cat.parameterize.underscore %>" +" class='options checkbox-options new_options' id=" +rno + " checked>" ;                                       
            addchecklist_item +='<label for='+ rno + " id=l-" + rno + ">" + getinputVal +'</label>';
            addchecklist_item +=' </div>';
            
            jQuery(this).closest(".add-checklistitem").prev().after(addchecklist_item);
            setTimeout(function(){
                jQuery("input#add-checklistitem-text-<%= index+1 %>").val('');
            },10);
        
        });

            </script>
            <% end %>
        </div>
    </div>
    <div class="scroll-bar horizontal" style="width: 667px; display: none;">
        <div class="thumb" style="left: 0px; width: 667px;">

        </div>
    </div>
</div>


<div class="checklist-action">
    <a href="javascript:void(0);" class="checklist-btn button">Save</a>
</div>
<script type="text/javascript">

     $('.checklist-btn').on('click', function() {
        obj = $(".checkbox-options")
        $.each(obj,function( i, val ) {
            var chk = val.checked;            
            var cat = val.name;
            var name = $("#l-"+val.id).text()
            $.ajax({
              url: '/checklist_answers/toggle?title='+name+'&&is_checked='+chk+'&&category='+cat,
              type: 'POST',
              data: {"completed": this.checked}
            });
         
        });

     });
</script>
<% end %>